# ğŸ“ë©”ëª¨\_231223

## ğŸ” í˜„ì¬ í•™ìŠµ í”Œëœ

- ì±… í›‘ê³ , MDN ë³´ë©´ì„œ PPT ë§Œë“¤ê¸°

| ìˆœì„œ | ì¼ì •  | ë‚´ìš©         | ê´€ë ¨ ì„œì /ê°•ì˜              |
| ---- | ----- | ------------ | --------------------------- |
| 1    | 45~47 | JS ê°œë… ê³µë¶€ | ëª¨ë˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ Deep Dive |

---

# 45. Promise

## ë¹„ë™ê¸° í•¨ìˆ˜

- ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´, í•¨ìˆ˜ ë‚´ë¶€ì˜ ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ë‹¤ í•´ë„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì¦‰ì‹œ ì¢…ë£Œ

```tsx
function foo() {
  console.log(1);
  // ë¹„ë™ê¸° ì‘ì—…
  setTimeout(() => {
    g = 100;
  }, 0);
  console.log(2);
}
```

- ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ë¶€ì˜ ë¹„ë™ê¸°ë„ ë™ì‘í•˜ëŠ” ì½”ë“œëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ì¢…ë£Œëœ ì´í›„ì— ì™„ë£Œëœë‹¤.
- í•¨ìˆ˜ ë‚´ë¶€ì˜ ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œì—ì„œ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì™¸ë¶€ë¡œ ë°˜í™˜í•˜ê±°ë‚˜, ìƒìœ„ ìŠ¤ì½”í”„ì˜ ë³€ìˆ˜ì— í• ë‹¹í–ˆì„ ë•Œ ê¸°ëŒ€í•œ ëŒ€ë¡œ ë™ì‘ x

```tsx
let g = 0;
setTimeout(() => {
  g = 100;
}, 0);
console.log(g); // 0
```

### ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ ì‹¤í–‰ì€?

- ì´ë²¤íŠ¸ê°€ ë°œìƒ ì‹œ, ì´ë²¤íŠ¸ì˜ í”„ë¡œí¼í‹°ì— ë°”ì¸ë”©ëœ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
- (xhr.onload) ì„œë²„ë¡œë¶€í„° ì‘ë‹µì´ ë„ì°©í•˜ë©´(load ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´) `íƒœìŠ¤í¬ í`ì— ì €ì¥ë˜ì–´ ëŒ€ê¸° => ì½œ ìŠ¤íƒì´ ë¹„ë©´ ì´ë²¤íŠ¸ ë£¨í”„ì— ì˜í•´ `ì½œ ìŠ¤íƒ`ìœ¼ë¡œ í‘¸ì‹œë˜ì–´ ì‹¤í–‰ëœë‹¤. => í•¨ìˆ˜ì´ë¯€ë¡œ í‰ê°€-ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ìƒì„±-ì½œ ìŠ¤íƒ í‘¸ì‹œ-ì‹¤í–‰ ê³¼ì •ì„ ê±°ì¹¨

### ì—ëŸ¬ ìºì¹˜ ëª»í•˜ëŠ” ì´ìœ ?

```tsx
try {
  setTimeout(() => throw new Error('NO'), 1000);
} catch (e) {
  console.error(e.message); // x
}
```

- setTimeout í˜¸ì¶œ, setTimeout ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ìƒì„± -> ì½œ ìŠ¤íƒì— push -> ì‹¤í–‰, ì¢…ë£Œ (ë¹„ë™ê¸°ë‹ˆê¹Œ ì½œë°±ì„ ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ) / **setTimeoutì— ì „ë‹¬ëœ ì½œë°± í•¨ìˆ˜(() => throw new Error('NO'))ê°€ íƒ€ì´ë¨¸ì— ë“±ë¡** -> ì½œ ìŠ¤íƒì—ì„œ pop -> íƒ€ì´ë¨¸ê°€ ë§Œë£Œë˜ë©´ ì½œë°±ì´ íƒœìŠ¤í¬ íë¡œ push -> ëŒ€ê¸° -> (ì½œ ìŠ¤íƒì´ ë¹„ì—ˆì„ ë•Œ) ì½œë°± í•¨ìˆ˜ì— ì˜í•´ ì½œ ìŠ¤íƒìœ¼ë¡œ push -> í‰ê°€, ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ìƒì„±, ì½œìŠ¤íƒ í‘¸ì‹œ, ì‹¤í–‰, ì¢…ë£Œ
- ì½œë°± í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ë•Œ, setTimeoutì€ ì½œ ìŠ¤íƒì— ì—†ìŒ
  => ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ê²ƒì´ setTimeoutì´ ì•„ë‹ˆë‹¤!
  - ê·¸ëŸ¼ ëˆ„êµ¬ëƒ? ì „ì—­ì´ë‹¤ => ì „ì—­ ì˜¤ë¥˜
- ì—ëŸ¬ëŠ” í˜¸ì¶œ ìŠ¤íƒ(call stack)ì„ ë”°ë¼ í˜¸ì¶œì(caller) ë°©í–¥ìœ¼ë¡œ ì „íŒŒ

## Promise

- `ë¹ŒíŠ¸ì¸ ê°ì²´`
- new ì—°ì‚°ìì™€ í•¨ê»˜ í˜¸ì¶œ => Promise ê°ì²´ë¥¼ ìƒì„±
- ì¸ìˆ˜: resolve, reject
- ìƒíƒœ: pending(ë¹„ë™ê¸° ìˆ˜í–‰ ì „/ê¸°ë³¸), fulfilled(ìˆ˜í–‰ ì„±ê³µ/resolve), rejected(ìˆ˜í–‰ ì‹¤íŒ¨/reject)
  - pendingê³¼ settled ìƒíƒœ

```tsx
const myPromise = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve("foo");
  }, 300);
});
```

- ğŸ‘‰ í”„ë¡œë¯¸ìŠ¤ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ ìƒíƒœì™€ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ê´€ë¦¬í•˜ëŠ” ê°ì²´

## Promise chaining methods

- `Promise.prototype.then`: ì–¸ì œë‚˜ promise ë°˜í™˜ / ì•”ë¬µì ìœ¼ë¡œ ë°˜í™˜ê°’ì„ resolve, reject
- `Promise.prototype.catch`: ë©”ì„œë“œì˜ ì½œë°±í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ rejected ìƒíƒœì¸ ê²½ìš°ì—ë§Œ í˜¸ì¶œ, ì–¸ì œë‚˜ promise ë°˜í™˜
- `Promise.prototype.finally`: ë©”ì„œë“œì˜ ì½œë°±í•¨ìˆ˜ëŠ” resolve, rejectì™€ ìƒê´€ì—†ì´ ë¬´ì¡°ê±´ í•œ ë²ˆ ì‹¤í–‰

### Promise catch ì‘ë™

- ë‚´ë¶€ì ìœ¼ë¡œ then(undefined, onRejected)ì„ í˜¸ì¶œí•œë‹¤.

```tsx
const wrongUrl = `https://wrongurl.com`;
promiseGet(wrongUrl)
  .then((res) => console.log(res))
  .then(undefined, (err) => console.log(err)); // Error: 404
```

### Promise static method

- Promise.resolve / Promise.reject
  - ì¡´ì¬í•˜ëŠ” ê°’ì„ ë˜í•‘í•˜ì—¬ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë§Œë“ ë‹¤.

```tsx
const successValue = { success: "nice" };
Promise.resolve(successValue);
```

- Promise.all
  - ì¸ìˆ˜: í”„ë¡œë¯¸ìŠ¤s ì´í„°ëŸ¬ë¸” (ì´í„°ëŸ¬ë¸” ìš”ì†Œê°€ í”„ë¡œë¯¸ìŠ¤ê°€ ì•„ë‹Œ ê²½ìš°, resolveë¥¼ í†µí•´ í”„ë¡œë¯¸ìŠ¤ë¡œ ë˜í•‘)
  - ë°°ì—´ ìˆœì„œ ë³´ì¥
  - í•˜ë‚˜ë¼ë„ rejectedë˜ë©´ ë‚˜ë¨¸ì§€ í”„ë¡œë¯¸ìŠ¤ fulfilledë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì¦‰ì‹œ ì¢…ë£Œ
- https://api.github.com/users/dusunax ì´ê±° ë­ì„!?
- Promise.race
  - ì¸ìˆ˜: í”„ë¡œë¯¸ìŠ¤s ì´í„°ëŸ¬ë¸”
  - ê°€ì¥ ë¨¼ì € fulfilledëœ í”„ë¡œë¯¸ìŠ¤ì˜ ì²˜ë¦¬ ê²°ê³¼ë¥¼ resoveí•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜
  - í•˜ë‚˜ë¼ë„ rejectedë˜ë©´ ë‚˜ë¨¸ì§€ í”„ë¡œë¯¸ìŠ¤ fulfilledë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì¦‰ì‹œ ì¢…ë£Œ
- [ES11] Promise.allSettled
  - ì¸ìˆ˜: í”„ë¡œë¯¸ìŠ¤s ì´í„°ëŸ¬ë¸”
  - ëª¨ë“  í”„ë¡œë¯¸ìŠ¤ì˜ ì²˜ë¦¬ ê²°ê³¼ê°€ ë‹´ê²¨ìˆë‹¤
  - rejected => {status: 'rejected', reason: Error: Error! at <~~>}

## ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ í microtask queue

- í”„ë¡œë¯¸ìŠ¤ì˜ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œì˜ ì½œë°± í•¨ìˆ˜ëŠ” ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì— ì €ì¥
- ì´ë²¤íŠ¸ë£¨í”„ëŠ” microtask queueê°€ ë¹„ë©´ task queueì˜ ëŒ€ê¸° í•¨ìˆ˜ë¥¼ ê°€ì ¸ê°

```tsx
setTimeout(() => console.log(1), 0);

Promise.resolve()
  .then(() => console.log(2))
  .then(() => console.log(3));

// 2
// 3
// 1
```

## fetch

- `í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ Web API`
- XMLHttpRequest ë³´ë‹¤ ì‚¬ìš©ë²•ì´ ê°„ë‹¨í•˜ê³ , í”„ë¡œë¯¸ìŠ¤ë¥¼ ì§€ì›í•œë‹¤
- HTTP Response ê°ì²´ë¥¼ ë˜í•‘í•œ Promise ê°ì²´ ë°˜í™˜
- ì—ëŸ¬ í•¸ë“¤ë§
  - ì—ëŸ¬ ì‹œ ok ìƒíƒœê°€ falseì¸ Response ê°ì²´ë¥¼ resolve
  - ë„¤íŠ¸ì›Œí¬ ì¥ì• , CORS ì‹œ, Promise reject

```tsx
const wrongUrl = `https://wrongurl.com`;
fetch(wrongUrl)
  .then((res) => {
    if (!res.ok) throw new Error(res.statusText);
    return res.json();
  })
  .then((todo) => console.log(todo))
  .catch((err) => console.log(err));
```

# ì œë„ˆë ˆì´í„° Generatorì™€ async/await

## Generator

- [ES6] ì½”ë“œ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€í–ˆë‹¤ê°€ í•„ìš”í•œ ì‹œì ì— ì¬ê°œ
- í•¨ìˆ˜ í˜¸ì¶œìì—ê²Œ ì œì–´ê¶Œì„ yield => í•¨ìˆ˜ ìƒíƒœë¥¼ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆë‹¤
- ì‹¤í–‰ ì‹œ, ì´í„°ëŸ¬ë¸”ì´ë©´ì„œ ì´í„°ë ˆì´í„°ì¸ ì œë„ˆë ˆì´í„° ê°ì²´ë¥¼ ë°˜í™˜

### ì •ì˜

- `function*`ë¡œ ì„ ì–¸, í•˜ë‚˜ ì´ìƒì˜ yield í‘œí˜„ì‹ì„ í¬í•¨
- í™”ì‚´í‘œx, new í‚¤ì›Œë“œì™€ ìƒì„±ìx

```tsx
function* genDecFunc() {
  yield 1;
}

const obj = {
  *genObjMethod() {
    yield 1;
  },
};
```

### Generator Object

- Generator ê°ì²´
- ë©”ì„œë“œ
  - next():
    - `value`, `done: false` í”„ë¡œí¼í‹°ë¥¼ ê°€ì§„ ê°ì²´ë¥¼ ë°˜í™˜, Iterator Result Object
    - yield ì•ê¹Œì§€ ì§„í–‰ / ë” ì—†ìœ¼ë©´ ë§ˆì§€ë§‰ê¹Œì§€ ì§„í–‰í•˜ê³  `done: true`
  - return():
    - `value`, `done: true`

## async/await

- [ES8] í”„ë¡œë¯¸ìŠ¤ ê¸°ë°˜ ë™ì‘ = Promise ê°ì²´ ë°˜í™˜
- awaitì€ promise settledê¹Œì§€ ë‹¤ìŒ ì‹¤í–‰ ëŒ€ê¸°

```tsx
let attempt = 3;
let success = false;

while (attempt > 0 && !success) {
  try {
    await new Promise((resolve) => setTimeout(resolve, 1000));

    // api call

    success = true;
    attempt = 0;
  } catch (error) {
    console.log(`attempt: ${attempt}`, error);
  } finally {
    attempt--;
  }
}

if (success) {
  console.log("good");
} else {
  console.log("bad");
}
```

- ë³‘ë ¬ ì²˜ë¦¬

```tsx
async function foo() {
  const res = await Promise.all([
    new Promise((resolve) => setTimeout(() => resolve(1), 3000)), // ~~/todo/1
    new Promise((resolve) => setTimeout(() => resolve(2), 2000)), // ~~/todo/2
    new Promise((resolve) => setTimeout(() => resolve(3), 1000)), // ~~/todo/3
  ]);
  console.log(res); // [1, 2, 3]
}

foo(); // ì•½ 3ì´ˆ
```

- ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ë¥¼ ê°€ì§€ê³  ë¹„ë™ê¸° ì²˜ë¦¬

```tsx
async function bar(n) {
  const a = await new Promise((resolve) => setTimeout(() => resolve(1), 3000));
  const b = await new Promise((resolve) =>
    setTimeout(() => resolve(a + 1), 2000)
  );
  const c = await new Promise((resolve) =>
    setTimeout(() => resolve(b + 1), 1000)
  );

  console.log([a, b, c]); // [1, 2, 3]
}

bar(); // ì•½ 6ì´ˆ
```

- ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ì™€ ë‹¬ë¦¬, `í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜`í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í˜¸ì¶œì caller ê°€ ëª…í™•í•˜ë‹¤ => ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ì „íŒŒë¥¼ ìºì¹˜í•  ìˆ˜ ìˆë‹¤.
- í”„ë¡œë¯¸ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ  > ì—ëŸ¬ í•¸ë“¤ë§ (callerê°€ ëª…í™•í•˜ë¯€ë¡œ ì—ëŸ¬ ìºì¹˜ ê°€ëŠ¥)
- catchë¬¸ ì•ˆì“°ë©´? ì—ëŸ¬ë¥¼ rejectí•˜ëŠ” promise ë°˜í™˜

---

### ì˜ˆì œ ì¬ë£Œ

- ê¹ƒí—™ api `https://api.github.com/users/`ë¥¼ ì‚¬ìš©í•´ì„œ ìŠ¤í„°ë””ì› ì´ë¦„ ë½‘ê¸°
- í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹
